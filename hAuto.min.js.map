{"version":3,"file":"hAuto.min.js","sources":["hAuto.js"],"names":["angular","window","Error","inputClass","spinnerClass","itemsClass","itemClass","formatter","item","extendOpts","$scope","key","defaultValue","keyBoardHandler","e","keyCode","moveUp","$apply","moveDown","selectItem","$curIndex","preventDefault","disablePointerHandler","hAuto","module","hAutoDir","$filter","$timeout","restrict","scope","displayFormatter","displayField","value","initItems","itemSelect","lazyLoad","link","element","attrs","promise","winEl","binded","loading","handler","reset","list","bindHandler","on","unbindHandler","off","getSpecifiedDiv","cssName","el","children","i","length","hasClass","filtering","items","searchTxt","inputEl","find","css","position","width","prop","lazyDataHandler","data","index","$event","stopPropagation","selected","$watch","newValue","cancel","$on","template","directive"],"mappings":"CAAC,SAASA,EAASC,GACf,YAEA,IAAuB,mBAAZD,GACP,KAAM,IAAIE,OAAM,yBAGpB,IAAIC,GAAa,eACbC,EAAe,8BACfC,EAAa,aACbC,EAAY,kBAEZC,EAAY,SAASC,GACrB,MAAOA,IAGPC,EAAa,SAASC,EAAQC,EAAKC,GAC9BF,EAAOC,KACRD,EAAOC,GAAOC,IAKlBC,EAAkB,SAASH,GAC3B,MAAO,UAASI,GACZ,OAAQA,EAAEC,SACN,IAAK,IACDL,EAAOM,SACPN,EAAOO,QACP,MACJ,KAAK,IACDP,EAAOQ,WACPR,EAAOO,QACP,MACJ,KAAK,IACDP,EAAOS,WAAWT,EAAOU,WACzBV,EAAOO,SAGfH,EAAEO,mBAKNC,EAAwB,SAASR,GACjC,OAAQA,EAAEC,SACN,IAAK,IACL,IAAK,IAED,WADAD,GAAEO,mBAKVE,EAAQvB,EAAQwB,OAAO,YAGvBC,EAAW,SAASC,EAASC,GAC7B,OACIC,SAAU,KACVC,OACIC,iBAAoB,IACpBC,aAAgB,IAChBC,MAAS,IACTC,UAAa,IACbC,WAAc,IACdC,SAAY,KAEhBC,KAAM,SAAS1B,EAAQ2B,EAASC,GAC5B,GAEIC,GAFAC,EAAQxC,EAAQqC,QAAQpC,GACxBwC,GAAS,CAEb/B,GAAOgC,SAAU,EACjBjC,EAAWC,EAAQ,aAAcP,GACjCM,EAAWC,EAAQ,eAAgBN,GACnCK,EAAWC,EAAQ,aAAcL,GACjCI,EAAWC,EAAQ,YAAaJ,GAChCG,EAAWC,EAAQ,gBAAiB,IAEhCA,EAAOH,UADP+B,EAAMR,iBACapB,EAAOoB,mBAEPvB,CAGvB,IAAIoC,GAAU9B,EAAgBH,GAE1BkC,EAAQ,WACRlC,EAAOU,UAAY,GACnBV,EAAOmC,SAGPC,EAAc,WACTL,IACDD,EAAMO,GAAG,QAASJ,GAClBH,EAAMO,GAAG,UAAWzB,GACpBmB,GAAS,IAIbO,EAAgB,WAChBR,EAAMS,IAAI,QAASN,GACnBH,EAAMS,IAAI,UAAW3B,GACrBmB,GAAS,GAGTS,EAAkB,SAASC,GAG3B,IAAK,GADDC,GADAC,EAAWhB,EAAQgB,WAEdC,EAAI,EAAGA,EAAID,EAASE,OAAQD,IAEjC,GADAF,EAAKpD,EAAQqC,QAAQgB,EAASC,IAC1BF,EAAGI,SAASL,GACZ,MAAOC,IAMfK,EAAY,SAASC,GAIjBhD,EAAOmC,KAHNnC,EAAOiD,UAGMjC,EAAQ,UAAUgC,EAAOhD,EAAOiD,aAElD,IAAIC,GAAUvB,EAAQwB,KAAK,QAC3BlC,GAAS,WACLuB,EAAgBxC,EAAOL,YAAYyD,KAC/BC,SAAY,WACZC,MAASJ,EAAQK,KAAK,eAAiB,SAI/CnB,KAGAoB,EAAkB,SAASC,GAC3BV,EAAUU,GACVzD,EAAOgC,SAAU,EACjBhC,EAAOO,SAGX2B,KAEAlC,EAAOM,OAAS,WACRN,EAAOU,UAAY,GACnBV,EAAOU,aAIfV,EAAOQ,SAAW,WACTR,EAAOU,UAAY,EAAKV,EAAOmC,KAAKU,QACrC7C,EAAOU,aAIfV,EAAOS,WAAa,SAASiD,EAAOC,GAChC,GAAY,EAARD,EAKA,YAJIC,IACAA,EAAOhD,iBACPgD,EAAOC,mBAIf,IAAI9D,GAAOE,EAAOmC,KAAKuB,EACnB9B,GAAMJ,YACNxB,EAAOwB,YACH1B,KAAMA,EACN4D,MAAOA,IAGf1D,EAAOsB,MAAQxB,EACfE,EAAOiD,UAAYjD,EAAOqB,aAAevB,EAAKE,EAAOqB,cAAgBrB,EAAOH,UAAUC,GACtFE,EAAO6D,UAAW,EACdF,IACAA,EAAOhD,iBACPgD,EAAOC,oBAKf5D,EAAO8D,OAAO,YAAa,SAASC,GAChC,OAAKA,GAAY/D,EAAO6D,UACpB3B,IACAI,SACItC,EAAO6D,WACP7D,EAAO6D,UAAW,KAKtBjC,EAAMH,UACFI,GACAZ,EAAS+C,QAAQnC,IAErBK,IACAlC,EAAOgC,SAAU,EACjBf,EAAS,WACL,GAAIiC,GAAUvB,EAAQwB,KAAK,QAC3BX,GAAgB,oBAAoBY,KAChCC,SAAY,WACZC,MAASJ,EAAQK,KAAK,eAAiB,cAI/C1B,EAAUZ,EAAS,WACfjB,EAAOyB,UACHQ,QAASuB,KAEd,WAKPT,GAAU/C,EAAOuB,aAKrBvB,EAAOiE,IAAI,WAAY,WACnB3B,OAIR4B,SAAU,gZAIlBrD,GAAMsD,UAAU,SAAU,UAAW,WAAYpD,KAEnDzB,QAASC","sourcesContent":["(function(angular, window) {\n    'use strict';\n\n    if (typeof angular === 'undefined') {\n        throw new Error('hAuto requires angular');\n    }\n\n    var inputClass = 'form-control';\n    var spinnerClass = 'fa fa-spinner fa-spin fa-lg';\n    var itemsClass = 'list-group';\n    var itemClass = 'list-group-item';\n\n    var formatter = function(item) {\n        return item;\n    };\n\n    var extendOpts = function($scope, key, defaultValue) {\n        if (!$scope[key]) {\n            $scope[key] = defaultValue;\n        }\n    };\n\n\n    var keyBoardHandler = function($scope) {\n        return function(e) {\n            switch (e.keyCode) {\n                case 38:\n                    $scope.moveUp();\n                    $scope.$apply();\n                    break;\n                case 40:\n                    $scope.moveDown();\n                    $scope.$apply();\n                    break;\n                case 13:\n                    $scope.selectItem($scope.$curIndex);\n                    $scope.$apply();\n                    break;\n            }\n            e.preventDefault();\n            return;\n        };\n    };\n\n    var disablePointerHandler = function(e) {\n        switch (e.keyCode) {\n            case 38:\n            case 40:\n                e.preventDefault();\n                return;\n        }\n    };\n\n    var hAuto = angular.module('hAuto', []);\n\n\n    var hAutoDir = function($filter, $timeout) {\n        return {\n            restrict: 'AE',\n            scope: {\n                'displayFormatter': '&',\n                'displayField': '@',\n                'value': '=',\n                'initItems': '=',\n                'itemSelect': '&',\n                'lazyLoad': '&'\n            },\n            link: function($scope, element, attrs) {\n                var winEl = angular.element(window);\n                var binded = false;\n                var promise;\n                $scope.loading = false;\n                extendOpts($scope, 'inputClass', inputClass);\n                extendOpts($scope, 'spinnerClass', spinnerClass);\n                extendOpts($scope, 'itemsClass', itemsClass);\n                extendOpts($scope, 'itemClass', itemClass);\n                extendOpts($scope, 'inputAddonTxt', '');\n                if (attrs.displayFormatter) {\n                    $scope.formatter = $scope.displayFormatter();\n                } else {\n                    $scope.formatter = formatter;\n                }\n\n                var handler = keyBoardHandler($scope);\n\n                var reset = function() {\n                    $scope.$curIndex = -1;\n                    $scope.list = [];\n                };\n\n                var bindHandler = function() {\n                    if (!binded) {\n                        winEl.on('keyup', handler);\n                        winEl.on('keydown', disablePointerHandler);\n                        binded = true;\n                    }\n                };\n\n                var unbindHandler = function() {\n                    winEl.off('keyup', handler);\n                    winEl.off('keydown', disablePointerHandler);\n                    binded = false;\n                };\n\n                var getSpecifiedDiv = function(cssName) {\n                    var children = element.children();\n                    var el;\n                    for (var i = 0; i < children.length; i++) {\n                        el = angular.element(children[i]);\n                        if (el.hasClass(cssName)) {\n                            return el;\n                        }\n                    }\n                    return;\n                };\n\n                var filtering = function(items) {\n                    if (!$scope.searchTxt) {\n                        $scope.list = [];\n                    } else {\n                        $scope.list = $filter('filter')(items, $scope.searchTxt);\n                    }\n                    var inputEl = element.find('input');\n                    $timeout(function() {\n                        getSpecifiedDiv($scope.itemsClass).css({\n                            'position': 'absolute',\n                            'width': inputEl.prop('offsetWidth') + 'px'\n                        });\n                    });\n\n                    bindHandler();\n                };\n\n                var lazyDataHandler = function(data) {\n                    filtering(data);\n                    $scope.loading = false;\n                    $scope.$apply();\n                };\n\n                reset();\n\n                $scope.moveUp = function() {\n                    if ($scope.$curIndex > 0) {\n                        $scope.$curIndex--;\n                    }\n                };\n\n                $scope.moveDown = function() {\n                    if (($scope.$curIndex + 1) < $scope.list.length) {\n                        $scope.$curIndex++;\n                    }\n                };\n\n                $scope.selectItem = function(index, $event) {\n                    if (index < 0) {\n                        if ($event) {\n                            $event.preventDefault();\n                            $event.stopPropagation();\n                        }\n                        return;\n                    }\n                    var item = $scope.list[index];\n                    if (attrs.itemSelect) {\n                        $scope.itemSelect({\n                            item: item,\n                            index: index\n                        });\n                    }\n                    $scope.value = item;\n                    $scope.searchTxt = $scope.displayField ? item[$scope.displayField] : $scope.formatter(item);\n                    $scope.selected = true;\n                    if ($event) {\n                        $event.preventDefault();\n                        $event.stopPropagation();\n                    }\n\n                };\n\n                $scope.$watch('searchTxt', function(newValue, oldValue) {\n                    if (!newValue || $scope.selected) {\n                        reset();\n                        unbindHandler();\n                        if ($scope.selected) {\n                            $scope.selected = false;\n                        }\n                        return;\n                    }\n\n                    if (attrs.lazyLoad) {\n                        if (promise) {\n                            $timeout.cancel([promise]);\n                        }\n                        reset();\n                        $scope.loading = true;\n                        $timeout(function() {\n                            var inputEl = element.find('input');\n                            getSpecifiedDiv('spinner-position').css({\n                                'position': 'absolute',\n                                'width': inputEl.prop('offsetWidth') + 'px'\n                            });\n                        });\n\n                        promise = $timeout(function() {\n                            $scope.lazyLoad({\n                                handler: lazyDataHandler\n                            });\n                        }, 1000);\n\n                        return;\n                    }\n\n                    filtering($scope.initItems);\n\n                });\n\n\n                $scope.$on('$destroy', function() {\n                    unbindHandler();\n                });\n\n            },\n            template: '<input type=\"text\" ng-class=\"inputClass\" ng-model=\"searchTxt\"/><div class=\"spinner-position\" ng-if=\"loading\"><i ng-class=\"spinnerClass\"></i></div><div ng-if=\"list.length !== 0\" ng-class=\"itemsClass\"><a ng-repeat=\"li in list\" href ng-click=\"selectItem($index, $event);\" class=\"{{itemClass}}\" ng-class=\"{active: $index === $curIndex}\">{{ displayField ? li[displayField] : formatter(li) }}</a></div>'\n        };\n    };\n\n    hAuto.directive('hAuto', ['$filter', '$timeout', hAutoDir]);\n\n}(angular, window));"],"sourceRoot":"/source/"}